From 21b64761d0e434e0ffa52c446a4c327e4f6ccf98 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bernhard=20K=C3=B6lbl?= <besentv@gmail.com>
Date: Mon, 7 Feb 2022 23:19:01 +0100
Subject: [PATCH v2 49/49] windows.media.speech: Implement
 ISpeechRecognitionResult_get_Constraint.

---
 dlls/windows.media.speech/speechrecognitionresult.c | 13 ++++++++++---
 .../windows_media_speech_private.h                  |  2 +-
 2 files changed, 11 insertions(+), 4 deletions(-)

diff --git a/dlls/windows.media.speech/speechrecognitionresult.c b/dlls/windows.media.speech/speechrecognitionresult.c
index b1d9b55f8e8..1beaeb0ffb2 100644
--- a/dlls/windows.media.speech/speechrecognitionresult.c
+++ b/dlls/windows.media.speech/speechrecognitionresult.c
@@ -300,6 +300,7 @@ struct speech_recognition_result
     ISpeechRecognitionResult2 ISpeechRecognitionResult2_iface;
     LONG ref;
 
+    ISpeechRecognitionConstraint *constraint;
     HSTRING text;
 };
 
@@ -428,8 +429,13 @@ static HRESULT STDMETHODCALLTYPE speech_recognition_result_GetAlternatives(
 static HRESULT STDMETHODCALLTYPE speech_recognition_result_get_Constraint(
     ISpeechRecognitionResult *iface, ISpeechRecognitionConstraint **value)
 {
-    FIXME("iface %p, operation %p stub!\n", iface, value);
-    return E_NOTIMPL;
+    struct speech_recognition_result *impl = impl_from_ISpeechRecognitionResult(iface);
+    
+    TRACE("iface %p, operation %p.\n", iface, value);
+
+    ISpeechRecognitionConstraint_AddRef(impl->constraint);
+    *value = impl->constraint;
+    return S_OK;
 }
 
 static HRESULT STDMETHODCALLTYPE speech_recognition_result_get_RulePath(
@@ -565,7 +571,7 @@ static const struct ISpeechRecognitionResult2Vtbl speech_recognition_result2_vtb
     speech_recognition_result2_get_PhraseDuration
 };
 
-HRESULT STDMETHODCALLTYPE speech_recognition_result_create(HSTRING text, ISpeechRecognitionResult **out)
+HRESULT STDMETHODCALLTYPE speech_recognition_result_create(HSTRING text, ISpeechRecognitionConstraint *constraint, ISpeechRecognitionResult **out)
 {
     struct speech_recognition_result *impl;
 
@@ -582,6 +588,7 @@ HRESULT STDMETHODCALLTYPE speech_recognition_result_create(HSTRING text, ISpeech
     impl->ref = 1;
 
     impl->text = text;
+    impl->constraint = constraint;
 
     *out = &impl->ISpeechRecognitionResult_iface;
     return S_OK;
diff --git a/dlls/windows.media.speech/windows_media_speech_private.h b/dlls/windows.media.speech/windows_media_speech_private.h
index c995a5f55b9..2868d804e85 100644
--- a/dlls/windows.media.speech/windows_media_speech_private.h
+++ b/dlls/windows.media.speech/windows_media_speech_private.h
@@ -69,7 +69,7 @@ void STDMETHODCALLTYPE speech_recognition_list_constraint_get_activation_factory
 void STDMETHODCALLTYPE speech_recognizer_get_activation_factory(IActivationFactory **factory) DECLSPEC_HIDDEN;
 
 HRESULT STDMETHODCALLTYPE speech_continuous_recognition_session_create(ISpeechContinuousRecognitionSession **out) DECLSPEC_HIDDEN;
-HRESULT STDMETHODCALLTYPE speech_recognition_result_create(HSTRING text, ISpeechRecognitionResult **out) DECLSPEC_HIDDEN;
+HRESULT STDMETHODCALLTYPE speech_recognition_result_create(HSTRING text, ISpeechRecognitionConstraint *constraint, ISpeechRecognitionResult **out) DECLSPEC_HIDDEN;
 HRESULT STDMETHODCALLTYPE speech_recognizer_state_changed_event_args_create_from_iid(REFIID iid, void **obj) DECLSPEC_HIDDEN;
 
 /*
-- 
2.35.1

